# Compound Fault Injection Configuration
# This configuration tests the observability stack with multiple simultaneous fault types
# Simulates realistic degraded production scenarios with combined failures

# Mode: mock (fault injection works with mock providers)
mode: mock

# Agent configuration
agent:
  agent_id: canary_fault_compound_001
  agent_name: Compound Fault Canary

# Mock provider base settings
mock_settings:
  # Base settings (overridden by fault injection profiles)
  llm_latency_ms: 500
  tool_latency_ms: 200
  tool_failure_rate: 0.0

# Fault injection configuration
fault_injection:
  # Enable fault injection
  enabled: true
  
  # Active fault profiles - multiple profiles demonstrate composability
  profiles:
    - high_latency
    - intermittent_failures
    - rate_limits
  
  # High latency profile
  # Simulates slow API responses
  high_latency:
    # Moderate latency (not as extreme as single-profile test)
    llm_latency_ms: 3000   # 3 seconds
    tool_latency_ms: 2000  # 2 seconds
  
  # Intermittent failures profile
  # Simulates unreliable APIs
  intermittent_failures:
    # Moderate failure rates
    llm_failure_rate: 0.15   # 15% failure rate
    tool_failure_rate: 0.20  # 20% failure rate
    failure_pattern: "random"
  
  # Rate limits profile
  # Simulates API rate limiting (HTTP 429 errors)
  rate_limits:
    # Trigger rate limiting after 5 calls
    trigger_after_calls: 5

# OpenTelemetry configuration
otlp:
  # OTLP collector endpoint
  endpoint: http://localhost:4317
  insecure: true

# Scenarios to execute
# All scenarios run with compound faults to test realistic degraded conditions
scenarios:
  - simple_tool_call      # Tests basic compound fault handling
  - multi_tool_chain      # Tests cumulative effects of multiple faults
  - tool_failure          # Tests triple-fault scenarios
  - high_token_usage      # Tests faults with large payloads
  - conversation_context  # Tests fault recovery across conversation turns
  - multi_agent          # Tests fault propagation in complex agent hierarchies

# Telemetry validation
# Validates that all fault types are correctly captured in telemetry
validation:
  prometheus_url: http://localhost:9090
  opensearch_url: https://localhost:9200
  opensearch_user: admin
  opensearch_password: ${OPENSEARCH_PASSWORD}

# About Compound Faults:
#
# This configuration demonstrates the composability of fault injection profiles.
# Multiple profiles are active simultaneously, creating realistic degraded scenarios:
#
# 1. High Latency: Every call is slow (3s for LLM, 2s for tools)
# 2. Intermittent Failures: 15-20% of calls fail randomly
# 3. Rate Limits: After 5 calls, rate limiting kicks in
#
# This combination tests:
# - How the system handles slow AND failing calls
# - Whether timeouts interact correctly with retries
# - How rate limiting affects already-degraded performance
# - Whether telemetry correctly attributes multiple fault types
#
# Real-world production systems often experience compound failures like this
# when infrastructure is degraded or under heavy load.
