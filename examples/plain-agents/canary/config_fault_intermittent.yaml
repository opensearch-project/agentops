# Intermittent Failures Fault Injection Configuration
# This configuration tests the observability stack's ability to handle random failures
# Simulates unreliable APIs with configurable failure rates and patterns

# Mode: mock (fault injection works with mock providers)
mode: mock

# Agent configuration
agent:
  agent_id: canary_fault_intermittent_001
  agent_name: Intermittent Failures Fault Canary

# Mock provider base settings
mock_settings:
  # Base settings (failure rates overridden by fault injection)
  llm_latency_ms: 500
  tool_latency_ms: 200
  tool_failure_rate: 0.0

# Fault injection configuration
fault_injection:
  # Enable fault injection
  enabled: true
  
  # Active fault profiles
  profiles:
    - intermittent_failures
  
  # Intermittent failures profile configuration
  intermittent_failures:
    # LLM failure rate: 20% of calls will fail
    llm_failure_rate: 0.2
    
    # Tool failure rate: 30% of calls will fail
    tool_failure_rate: 0.3
    
    # Failure pattern: random, periodic, or burst
    # This config demonstrates random pattern
    # To test other patterns, change this value to "periodic" or "burst"
    failure_pattern: "random"
    
    # Note: For periodic pattern, failures occur every N calls
    # For burst pattern, failures occur in clusters
    # The specific behavior is implemented in the provider classes

# OpenTelemetry configuration
otlp:
  # OTLP collector endpoint
  endpoint: http://localhost:4317
  insecure: true

# Scenarios to execute
# All scenarios run with intermittent failures to test error handling
scenarios:
  - simple_tool_call      # Tests basic error handling
  - multi_tool_chain      # Tests error propagation across multiple calls
  - tool_failure          # Tests compound failure scenarios
  - high_token_usage      # Tests failures with large payloads
  - conversation_context  # Tests error recovery in multi-turn conversations
  - multi_agent          # Tests error propagation in agent hierarchies

# Telemetry validation
# Validates that failures are correctly captured in error spans and logs
validation:
  prometheus_url: http://localhost:9090
  opensearch_url: https://localhost:9200
  opensearch_user: admin
  opensearch_password: ${OPENSEARCH_PASSWORD}

# Testing Different Failure Patterns:
# 
# To test PERIODIC pattern (failures every Nth call):
#   Change failure_pattern to "periodic"
#   Failures will occur in a predictable pattern
#
# To test BURST pattern (clusters of failures):
#   Change failure_pattern to "burst"
#   Failures will occur in groups followed by successful periods
#
# To test RANDOM pattern (unpredictable failures):
#   Keep failure_pattern as "random" (default)
#   Failures will occur randomly based on the configured rates
